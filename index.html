<html>
<head>
  <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200&family=Varela+Round&display=swap" rel="stylesheet">
  <style>
  .vdu {
    width: 100%;
    //text-align:center;
    //background-color: red;
  }

  canvas {
    display: inline;
  }

  *{
    font-family: 'Varela Round', sans-serif;
  }

</style>
<script src='./vdu.js'></script>
</head>
<body>
  <header>
    <h1>VDU-web</h1>
    <h2 style="color:#ffff00">BBC Micro graphics JavaScript library</h2>


  </header>

  <main>
    <h2>Retro pixels fast</h2>

    <p>Create 8-bit graphics with a few lines of JavaScript! A BBC Micro (1981) <a href="https://tobylobster.github.io/mos/mos/S-s5.html">VDU</a> graphics compatible library.</p>
    <div id="hello" class="vdu"></div>
    <pre>
      new BeebVDU()

      for (let x=0;x<800;x++){
        GCOL(0,RND(7))
        DRAW(RND(1280),RND(1024))
      }

      PRINT("Hello world!")</pre>

      <h2>A time machine for your code</h2>
      <div id="blackhole" class="vdu"></div>
      <p>Render the same code in different display eras! Choose chunky 80s pixels, finer 90s Acorn Archimedes or smooth modern day resolutions by just adding a <code>MODE</code> command:</p>
      <pre>
        new BeebVDU()
        MODE(0)
        PRINT("Blackhole rules!")
        for (let X=-25;X<25;X++){
          for (let Y=-25;Y<25;Y++){
            let x = 640-15*X-12*Y
            let y = 512-X+7*Y+50*(-8/SQR(1+(X*X+Y*Y)/5))
            PLOT(69,x,y)
          }
        }</pre>


        <h2>Real-time animation</h2>
        <div id="waves" class="vdu"></div>
        <p>Put your animation code in a JavaScript function and web-VDU will draw every animation frame</p>
        <pre>
          new BeebVDU()
          function draw(){
            MODE(0)

            //...your cool shader JS here

            GCOL(0,color)
            PLOT(69,x,x)
          };
          ANIMATE(draw);
        </pre>

        <h2>That's a Moire</h2>
        <p>Build interactions with web-VDU the same as you would with any HTML5 canvas.
          <div id="drawHello" class="vdu"></div>


          <h2>Try it now</h2>
        <p> You can see 100s of examples of what's possible on the original 1980s BBC Micro on <a href="https://www.bbcmicrobot.com">BBC Micro Bot</a>. </p>
      </p>




    </main>

    <footer>
      <p>8bitkick</p>
    </footer>
  </body>
  <script>

  new BeebVDU({id:'hello'})
  MODE(2)
  for (let x=0;x<800;x++){
    GCOL(0,RND(7))
    DRAW(RND(1280),RND(1024))
  }

  PRINT("Hello world!")

  let vdu7 = new BeebVDU({id:'drawHello'})
  function drawHello(x,y){
    vdu7.mode(1)
    for (let c=0;c<1640;c++){
      vdu7.gcol(0,(c&3)+1)
      vdu7.move(x,y)
      vdu7.draw(640+SIN(c)*1280,512+COS(c)*1024)
    }
    vdu7.printtab(16,15,"Web VDU")
  }
  drawHello(640,512)
  vdu7.canvas.addEventListener("pointerdown", getMousePos, false);
  vdu7.canvas.addEventListener("pointermove", getMousePos, false);
  function  getMousePos(evt) {
    var rect = vdu7.canvas.getBoundingClientRect(),
    scaleX = vdu7.canvas.width / rect.width,
    scaleY = vdu7.canvas.height / rect.height;
    let a = {
      x: (evt.clientX - rect.left) * scaleX,
      y: (evt.clientY - rect.top) * scaleY
    }
    drawHello(a.x*4,1024-a.y*4);
  }






  //   new BeebVDU({id:'hello2'})
  //   MODE(2)
  //   for (let x=0;x<10;x++){
  //   COLOR(RND(7))
  //   PRINT("Hello world!")
  // }


  //
  //
  // new BeebVDU({id:'onlyway'})
  // MODE(2)
  // GCOL(0,5)
  // let F=1,Y=512;
  //
  // while(Y<0){
  //   N=(N % 4)+1
  //   GCOL(0,N)
  //   MOVE(0,Y)
  //   DRAW(1280,Y)
  //   Y=Y-F
  //   F=F*1.2
  // }
  //
  // for(let I=-8.5;I<8.5;I++){
  //   MOVE(640+I*75,512)
  //   DRAW(640+I*220,0)
  // }
  //
  // PRINTTAB(2,11,"PEEPEE   POOPOO");
  //




  // // Blackhole
  // let vdu3 = new BeebVDU({id:'blackhole'})
  //   vdu3.mode(2)
  //   vdu3.paletteLUT[1]=0xffffffff;
  // function a(){
  //     vdu3.mode(1)
  //   let c = Date.now() / 2000;
  //   vdu3.printtab(0,1," z=-8/(1+x^2+y^2)")
  //   vdu3.printtab(0,3," Blackhole Rules!")
  //   function P(U,X,Y){
  //     vdu3.gcol(0,1)
  //     let x = 640-15*X-13*Y*Math.cos(c)
  //     let y = 512-4*X+7*Y+50*(-8/Math.sqrt(1+(X*X+Y*Y)/5))
  //     vdu3.point(x,y)
  //   }
  //   for (let X=-25;X<25;X++){
  //     for (let Y=-25;Y<25;Y++){
  //       for (let U=0;U<2;U++){
  //         for (let V=0;V<1;V++){
  //            P(4+83*U,X+U,Y+V);
  //         }
  //       }
  //       for (let U=0;U<2;U+=0.5){
  //         P(4+SGN(U),X+((1 & U)+.5),Y+(1 & U));
  //       }
  //     }
  //   }
  // }
  // ANIMATION(a);


  // Blackhole
  let ms = [
    {mode:2, note:"BBC Micro (160x256)"},
    {mode:1, note:"BBC Micro (320x256)"},
    {mode:0, note:"BBC Micro (640x256)"},
    {mode:21, note:"Acorn Archimedes (640x512)"},
    {mode:100, note:"Web VDU (1280x1024)"}
  ];
  let bh = new BeebVDU({id:'blackhole',scale:1})
  let j = 0;
  function blackholeFrame(){
    let m = ms[Math.floor(j/2) % 5].mode;
    bh.mode(m);
    j+=0.03;

    for (let X=-25;X<25;X++){
      for (let Y=-25;Y<25;Y++){
        let x = 640-15*X-12*Y*COS(j)
        let y = 512-X+7*Y+50*(-8/SQR(1+(X*X+Y*Y)/5))
        bh.plot(69,x,y)
      }
    }
    bh.print("")
    bh.print(ms[Math.floor(j/2) % 5].note);
    bh.print("MODE "+m)
  }
  bh.animate(blackholeFrame);




  // wave
  let wave = new BeebVDU({id:'waves'})


  function waveAnimation(){
    wave.mode(1)
    wave.paletteLUT[1]=0xffff0000;
    wave.paletteLUT[2]=0xffffff00;
    let c = Date.now() / 100, o = Math.sin(c/(Math.PI*2*10))*12;
    //vdu.cls()
    for (let b=1;b<=1024;b+=4){
      let p=.4, d = [c];
      for (let a=1;a<=1280;a+=4){
        let x=.5, s=o, t=a/640+2, u=b/512+2;
        for (let n=0;n<3;n++){
          x=t*x*(1-x)*Math.cos(o/10)
          let f=t*(1-2*x)
          x=u*x*(1-x)
          f=f*u*(1-2*x)
          x=t*x*(1-x)
          f=f*t*(1-2*x)
          x=u*x*(1-x)
          s=s+(Math.log(Math.abs(f*u*(1-2*x))))
        }
        let i=a>>2
        s=d[i]+p+2-s/12
        // if (s>7) s=7
        // if (s<0) s=0
        let e=(s-Math.floor(s)) / 17
        p=e*7
        if (i!=0) d[i-1]=d[i-1]+e*4
        d[i]=d[i]+e*5
        d[i+1]=e
        wave.gcol(0,s & 0x3)
        wave.plot(69,a,b)
      }
      //  vdu.printtab(0,0,c.toString((10)))
    }
  };
  wave.animate(waveAnimation);



  // Ray Tracer
  // MODE2
  // VDU5
  // for(let N=8; N<247; N++){
  // FORM=0TO159
  // X=0:Y=-.1:Z=3:U=(M-79.5)/80:V=(N-127.5)/160:W=1/Math.sqrt(U*U+V*V+1):U=U*W:V=V*W:I=Math.sgn(U):G=1
  // 1E=X-I:F=Y-I:P=U*E+V*F-W*Z:D=P*P-E*E-F*F-Z*Z+1:IFD>0T=-P-SQRD:IFT>0X=X+T*U:Y=Y+T*V:Z=Z-T*W:E=X-I:F=Y-I:G=Z:P=2*(U*E+V*F-W*G):U=U-P*E:V=V-P*F:W=W+P*G:I=-I:GOTO1
  // 2IFV<0P=(Y+2)/V:GCOL0,1AND INT(X-U*P)+INT(Z+W*P)ELSER=ATN(U/W):GCOL0,6-(V<.2+.1*COS(3*R)*ABSSIN(5*R)-(ABSG<.35))
  // 3PLOT69,8*M,4*N
  // }

  // let vdu4 = new BeebVDU()
  // function c(){
  //
  //   for(let N=8; N<247; N++){
  //       for(let M=0; M<160; M++){
  //   X=0:Y=-.1:Z=3:U=(M-79.5)/80:V=(N-127.5)/160:W=1/Math.sqrt(U*U+V*V+1):U=U*W:V=V*W:I=Math.sgn(U):G=1
  //
  //   // 1
  //   E=X-I:F=Y-I:P=U*E+V*F-W*Z:D=P*P-E*E-F*F-Z*Z+1:D>0T=-P-SQRD:IFT>0X=X+T*U:Y=Y+T*V:Z=Z-T*W:E=X-I:F=Y-I:G=Z:P=2*(U*E+V*F-W*G):U=U-P*E:V=V-P*F:W=W+P*G:I=-I:GOTO1
  //
  //   2IFV<0P=(Y+2)/V:GCOL0,1AND INT(X-U*P)+INT(Z+W*P)ELSER=ATN(U/W):GCOL0,6-(V<.2+.1*COS(3*R)*ABSSIN(5*R)-(ABSG<.35))
  //   3PLOT69,8*M,4*N
  //   }
  //
  //
  //
  // }
  // ANIMATION(a);



</script>
</html>
